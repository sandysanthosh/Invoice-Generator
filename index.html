<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <style>
        /* Your existing styles */
    </style>
</head>
<body>
    <div class="container">
        <h1>Invoice Generator</h1>
        <form id="invoice-form">
            <!-- Your existing form elements -->
        </form>
        <div id="invoice-output"></div>
    </div>

    <script>
        // Function to dynamically bind events
        function bindDownloadButton(clientName, invoiceDate, items, totalAmount) {
            const downloadBtn = document.createElement('button');
            downloadBtn.textContent = "Download PDF";
            downloadBtn.style.marginTop = "10px";
            downloadBtn.addEventListener('click', () => downloadPDF(clientName, invoiceDate, items, totalAmount));
            document.getElementById('invoice-output').appendChild(downloadBtn);
        }

        // Function to handle dynamic pagination in PDF
        function downloadPDF(clientName, invoiceDate, items, totalAmount) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            let yOffset = 20;

            doc.setFont("helvetica", "bold");
            doc.text("Invoice", 105, yOffset, { align: "center" });
            yOffset += 10;

            doc.setFont("helvetica", "normal");
            doc.text(`Client Name: ${clientName}`, 20, yOffset);
            yOffset += 10;
            doc.text(`Invoice Date: ${invoiceDate}`, 20, yOffset);
            yOffset += 10;

            doc.text("Items:", 20, yOffset);
            yOffset += 10;

            items.forEach((item, index) => {
                if (yOffset > 270) {
                    doc.addPage();
                    yOffset = 20;
                }
                doc.text(`${index + 1}. ${item.description} | ${item.quantity} x ${item.price.toFixed(2)} = ${item.total.toFixed(2)}`, 20, yOffset);
                yOffset += 10;
            });

            if (yOffset > 270) {
                doc.addPage();
                yOffset = 20;
            }

            doc.text(`Total Amount: ${totalAmount.toFixed(2)}`, 20, yOffset);

            const fileName = `Invoice_${clientName.replace(/[^a-z0-9]/gi, '_').replace(/^_+|_+$/g, '')}.pdf`;
            doc.save(fileName);
        }

        document.getElementById('invoice-form').addEventListener('submit', (e) => {
            e.preventDefault();

            const clientName = document.getElementById('clientName').value.trim();
            const invoiceDate = document.getElementById('invoiceDate').value;

            const items = Array.from(document.querySelectorAll('#item-container .item')).map(item => ({
                description: item.querySelector('.description').value.trim(),
                quantity: parseInt(item.querySelector('.quantity').value),
                price: parseFloat(item.querySelector('.price').value),
                total: parseFloat(item.querySelector('.quantity').value) * parseFloat(item.querySelector('.price').value)
            }));

            const totalAmount = items.reduce((sum, item) => sum + item.total, 0);

            const invoiceOutput = `
                <h2>Invoice</h2>
                <p><strong>Client Name:</strong> ${clientName}</p>
                <p><strong>Invoice Date:</strong> ${invoiceDate}</p>
                <table border="1" width="100%" style="border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th>Description</th>
                            <th>Quantity</th>
                            <th>Price</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${items.map(item => `
                            <tr>
                                <td>${item.description}</td>
                                <td>${item.quantity}</td>
                                <td>${item.price.toFixed(2)}</td>
                                <td>${item.total.toFixed(2)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                <h3>Total: ${totalAmount.toFixed(2)}</h3>
            `;

            document.getElementById('invoice-output').innerHTML = invoiceOutput;
            bindDownloadButton(clientName, invoiceDate, items, totalAmount);
        });
    </script>
</body>
</html>
